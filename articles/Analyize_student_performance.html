<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyze student performance • RSAVS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyze student performance">
<meta property="og:description" content="RSAVS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RSAVS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Analyize_student_performance.html">Analyze student performance</a>
    </li>
    <li>
      <a href="../articles/Play_with_iris_dataset.html">Play with iris dataset</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://github.com/fenguoerbian/RSAVS/releases/tag/v0.1.3">RSAVS 0.1.3</a>
    </li>
    <li>
      <a href="https://github.com/fenguoerbian/RSAVS/releases/tag/v0.1.2">RSAVS 0.1.2</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fenguoerbian/RSAVS/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Analyize_student_performance_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analyze student performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fenguoerbian/RSAVS/blob/master/vignettes/Analyize_student_performance.Rmd"><code>vignettes/Analyize_student_performance.Rmd</code></a></small>
      <div class="hidden name"><code>Analyize_student_performance.Rmd</code></div>

    </div>

    
    
<p>In this article, we use the student performance dataset to demonstrate how to perform subgroup analysis and variable selection simultaneously via the package <code>RSAVS</code>.</p>
<p><strong>NOTE:</strong> This article is finished with <code>RSAVS</code> version 0.1.2.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr/">skimr</a></span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"fenguoerbian/RSAVS"</span>, ref <span class="op">=</span> <span class="st">"v0.1.2"</span><span class="op">)</span>
<span class="co">#&gt; Using github PAT from envvar GITHUB_PAT</span>
<span class="co">#&gt; Downloading GitHub repo fenguoerbian/RSAVS@v0.1.2</span>
<span class="co">#&gt; Running `R CMD build`...</span>
<span class="co">#&gt; * checking for file ‘/tmp/RtmpdjeY2B/remotes37a93b6441d3/fenguoerbian-RSAVS-fe2e615/DESCRIPTION’ ... OK</span>
<span class="co">#&gt; * preparing ‘RSAVS’:</span>
<span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span>
<span class="co">#&gt; * cleaning src</span>
<span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span>
<span class="co">#&gt; * checking for empty or unneeded directories</span>
<span class="co">#&gt; * building ‘RSAVS_0.1.2.tar.gz’</span>
<span class="co">#&gt; Installing package into '/home/runner/work/_temp/Library'</span>
<span class="co">#&gt; (as 'lib' is unspecified)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fenguoerbian.github.io/RSAVS/">RSAVS</a></span><span class="op">)</span></code></pre></div>
<div id="introduction-to-the-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-the-dataset" class="anchor"></a>Introduction to the dataset</h1>
<p>This student performance dataset is about the grading point of evaluations of 1044 Portuguese students from two core classes(Math and Portuguese). There are 395 observations in the math data frame <code>mat_df</code> and 649 observations in the Portuguese data frame <code>por_df</code>. And the full dataset <code>full_df</code> is just the combination of these two data frames resulting 1044 observations. You can find details about these datasets via <code><a href="../reference/Student_performance_dataset.html">?full_df</a></code>.</p>
<p>In later analysis, we will use the full dataset <code>full_df</code>. The basic information of this dataset is shown below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">full_df</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">full_df</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1044</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">33</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">school</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">address</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">famsize</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Pstatus</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Mjob</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Fjob</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">reason</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">guardian</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">schoolsup</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">famsup</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">paid</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">activities</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">nursery</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">higher</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">internet</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">romantic</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">16.73</td>
<td align="right">1.24</td>
<td align="right">15</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">18</td>
<td align="right">22</td>
<td align="left">▇▅▅▁▁</td>
</tr>
<tr class="even">
<td align="left">Medu</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.60</td>
<td align="right">1.12</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="left">▁▅▇▆▇</td>
</tr>
<tr class="odd">
<td align="left">Fedu</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.39</td>
<td align="right">1.10</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="left">▁▆▇▆▆</td>
</tr>
<tr class="even">
<td align="left">traveltime</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.52</td>
<td align="right">0.73</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">▇▅▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">studytime</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.97</td>
<td align="right">0.83</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">▅▇▁▂▁</td>
</tr>
<tr class="even">
<td align="left">failures</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.26</td>
<td align="right">0.66</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">famrel</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.94</td>
<td align="right">0.93</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="left">▁▁▂▇▅</td>
</tr>
<tr class="even">
<td align="left">freetime</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.20</td>
<td align="right">1.03</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="left">▁▃▇▆▂</td>
</tr>
<tr class="odd">
<td align="left">goout</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.16</td>
<td align="right">1.15</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="left">▂▆▇▆▃</td>
</tr>
<tr class="even">
<td align="left">Dalc</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.49</td>
<td align="right">0.91</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Walc</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.28</td>
<td align="right">1.29</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="left">▇▅▅▃▂</td>
</tr>
<tr class="even">
<td align="left">health</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.54</td>
<td align="right">1.42</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="left">▃▂▅▃▇</td>
</tr>
<tr class="odd">
<td align="left">absences</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.43</td>
<td align="right">6.21</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">6</td>
<td align="right">75</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">G1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.21</td>
<td align="right">2.98</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">19</td>
<td align="left">▁▂▇▇▂</td>
</tr>
<tr class="odd">
<td align="left">G2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.25</td>
<td align="right">3.29</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">19</td>
<td align="left">▁▂▇▇▂</td>
</tr>
<tr class="even">
<td align="left">G3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.34</td>
<td align="right">3.86</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">11</td>
<td align="right">14</td>
<td align="right">20</td>
<td align="left">▁▂▇▆▁</td>
</tr>
</tbody>
</table>
<p>Our interest is <code>G3</code>, the final grade. And we want to understand how it’s related to those covariates. Note that although there seems to be several numeric variables in this datasets, most of them are actually binary or nominal coded.</p>
<p>First of all, we project the data on to the space spaned by most of the binary and nominal variables in the dataset. This gives us some basic understanding about how the average final grade is distributed among different observed subgroups.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">G3</span> <span class="op">~</span> <span class="va">school</span> <span class="op">+</span> <span class="va">address</span> <span class="op">+</span> <span class="va">Pstatus</span> <span class="op">+</span> <span class="va">famsize</span> <span class="op">+</span> <span class="va">schoolsup</span> <span class="op">+</span> <span class="va">famsup</span> <span class="op">+</span> <span class="va">activities</span> <span class="op">+</span> <span class="va">paid</span> <span class="op">+</span> <span class="va">internet</span> <span class="op">+</span> <span class="va">nursery</span> <span class="op">+</span> <span class="va">higher</span> <span class="op">+</span> <span class="va">romantic</span> <span class="op">+</span> <span class="va">Mjob</span> <span class="op">+</span> <span class="va">Fjob</span> <span class="op">+</span> <span class="va">guardian</span> <span class="op">+</span> <span class="va">reason</span>, data <span class="op">=</span> <span class="va">full_df</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Analyize_student_performance_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Looks like most of the grades are centered between 10-14 with some heavy tail at the lower end.</p>
<p>Next, we try expolore the relationship between individuals and the average grading point of the observed subgroup via OLS.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">Medu</span> <span class="op">+</span> <span class="va">Fedu</span> <span class="op">+</span> <span class="va">traveltime</span> <span class="op">+</span> <span class="va">studytime</span> <span class="op">+</span> <span class="va">failures</span>  <span class="op">+</span> <span class="va">famrel</span> <span class="op">+</span> <span class="va">freetime</span> <span class="op">+</span> <span class="va">goout</span> <span class="op">+</span> <span class="va">Dalc</span> <span class="op">+</span> <span class="va">Walc</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">absences</span>, 
           data <span class="op">=</span> <span class="va">full_df</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Analyize_student_performance_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The fitted value doesn’t tell much, but the residual plot tells something</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p><img src="Analyize_student_performance_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>It’s skewed and potentially multimodal, which indicates a robust regression, along with a latent subgroup structure, would be appropriate.Thus, we analyze the dataset by the proposed method of this package with the <code>L1</code> loss and the <code>SCAD</code> penalty in this study.</p>
</div>
<div id="robust-subgroup-analysis-and-variable-selection" class="section level1">
<h1 class="hasAnchor">
<a href="#robust-subgroup-analysis-and-variable-selection" class="anchor"></a>Robust subgroup analysis and variable selection</h1>
<p>Before the analysis, we randomly sample 100 observations and denote this dataset as <span class="math inline">\(D_2\)</span>, and use the remaining 944 observations as the training dataset <span class="math inline">\(D_1\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepare the full dataset</span>
<span class="va">y_vec_full</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">fitted.values</span>
<span class="va">x_mat_full</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>    <span class="co"># do not include the intercept term!</span>

<span class="co"># sample 100 observations as test set</span>
<span class="va">test_num</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span>
<span class="va">test_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">full_df</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">test_num</span>, replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># get the training set</span>
<span class="va">x_mat</span> <span class="op">&lt;-</span> <span class="va">x_mat_full</span><span class="op">[</span><span class="op">-</span><span class="va">test_idx</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>
<span class="va">y_vec</span> <span class="op">&lt;-</span> <span class="va">y_vec_full</span><span class="op">[</span><span class="op">-</span><span class="va">test_idx</span><span class="op">]</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x_mat</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x_mat</span><span class="op">)</span>

<span class="co"># get the test set</span>
<span class="va">y_vec_test</span> <span class="op">&lt;-</span> <span class="va">y_vec_full</span><span class="op">[</span><span class="va">test_idx</span><span class="op">]</span>
<span class="va">x_mat_test</span> <span class="op">&lt;-</span> <span class="va">x_mat_full</span><span class="op">[</span><span class="va">test_idx</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></code></pre></div>
<div id="analysis-on-the-training-set" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-on-the-training-set" class="anchor"></a>Analysis on the training set</h2>
<p>Set some basic variables for the proposed algorithm</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lam1_len</span> <span class="op">&lt;-</span> <span class="fl">40</span>    <span class="co"># length of lam1_vec</span>
<span class="va">lam2_len</span> <span class="op">&lt;-</span> <span class="fl">30</span>    <span class="co"># length of lam2_vec</span>
<span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">5</span>    <span class="co"># constant needed for mBIC</span></code></pre></div>
<p>Then we can apply our method at the training set. By default, it will use <code>L1</code> loss function coupled with the <code>SCAD</code> penalty. You can use <code><a href="../reference/RSAVS_LargeN.html">?RSAVS_LargeN</a></code> to find out more about this function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># It will take some time!</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RSAVS_LargeN.html">RSAVS_LargeN</a></span><span class="op">(</span>y_vec <span class="op">=</span> <span class="va">y_vec</span>, x_mat <span class="op">=</span> <span class="va">x_mat</span>, 
                    lam1_length <span class="op">=</span> <span class="va">lam1_len</span>, lam2_length <span class="op">=</span> <span class="va">lam2_len</span>,
                    phi <span class="op">=</span> <span class="va">phi</span>, tol <span class="op">=</span> <span class="fl">0.001</span>, max_iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; Basic variables initialized.</span>
<span class="co">#&gt; Beta finished.</span>
<span class="co">#&gt; Mu finished.</span>
<span class="co">#&gt; Z finished.</span>
<span class="co">#&gt; S finished.</span>
<span class="co">#&gt; W finished.</span>
<span class="co">#&gt; q1 finished.</span>
<span class="co">#&gt; q2 finished.</span>
<span class="co">#&gt; q3 finished.</span>
<span class="co">#&gt; D started.</span>
<span class="co">#&gt; D finished.</span>
<span class="co">#&gt; beta left finished.</span>
<span class="co">#&gt; mu left finished.</span>
<span class="co">#&gt; [1] "pamk fail!"</span></code></pre></div>
<p>The proposed algorithm can do subgroup analysis and variable selection simultaneously via regularization method. It will search over the grid space spanned by <code>lam1</code> and <code>lam2</code>. And choose a best one according to a modified BIC criteria.</p>
<p>We can check the covariate effect with</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_ind</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">best_ind</span>
<span class="va">mu_new</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">mu_improve_mat</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">best_ind</span>, <span class="op">]</span>
<span class="va">beta_new</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">w_mat</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">best_ind</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beta_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x_mat</span><span class="op">)</span>
<span class="va">beta_new</span>
<span class="co">#&gt;        sexM         age        Medu        Fedu  traveltime   studytime </span>
<span class="co">#&gt;  0.00000000 -0.03657224  0.22212294  0.00000000  0.00000000  0.00000000 </span>
<span class="co">#&gt;    failures      famrel    freetime       goout        Dalc        Walc </span>
<span class="co">#&gt;  0.00000000  0.00000000  0.00000000  0.00000000  0.00000000  0.00000000 </span>
<span class="co">#&gt;      health    absences </span>
<span class="co">#&gt;  0.00000000  0.00000000</span></code></pre></div>
<p>and the estimated subgroup information with</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span>
<span class="co">#&gt; mu_new</span>
<span class="co">#&gt; 11.4653382428383 11.4729496225838 </span>
<span class="co">#&gt;              442              502</span></code></pre></div>
<p>Also we can visualize the density plot of <code>G3</code> for these identified subgroups</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">y_vec</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">mu_new</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y_vec</span><span class="op">[</span><span class="va">id</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="Analyize_student_performance_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>As we can see, the algorithm gives us a reasonable partition of the observations, but the estimation of subgroup effects <code>mu_new</code> is quite indistinguishable due to the presence of the penalty functions.</p>
<p>We can further improve these estimations with an ordinary robust regression without any penalty functions given the estimated parameter structure from the previous results. And we can perform this post-selection estimation over the whole solution plane. (Since there are <code>lam1</code> and <code>lam2</code>, the regular solution path becomes a solution plane.)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mu_further_improve_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">lam1_len</span> <span class="op">*</span> <span class="va">lam2_len</span>, ncol <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
<span class="va">beta_further_improve_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">lam1_len</span> <span class="op">*</span> <span class="va">lam2_len</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
<span class="va">bic_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">lam1_len</span> <span class="op">*</span> <span class="va">lam2_len</span><span class="op">)</span>
<span class="va">max_bic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">bic_mat</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span> <span class="op">:</span> <span class="op">(</span><span class="va">lam1_len</span> <span class="op">*</span> <span class="va">lam2_len</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RSAVS_Further_Improve.html">RSAVS_Further_Improve</a></span><span class="op">(</span>y_vec <span class="op">=</span> <span class="va">y_vec</span>, x_mat <span class="op">=</span> <span class="va">x_mat</span>, mu_vec <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">mu_improve_mat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, beta_vec <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">w_mat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span>
  <span class="va">mu_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">mu_vec</span><span class="op">)</span>
  <span class="va">beta_new</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">beta_vec</span>
  <span class="va">mu_further_improve_mat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu_new</span>
  <span class="va">beta_further_improve_mat</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta_new</span>
  <span class="va">bic_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">RSAVS</span><span class="fu">:::</span><span class="fu"><a href="../reference/RSAVS_Compute_BIC.html">RSAVS_Compute_BIC</a></span><span class="op">(</span><span class="va">y_vec</span>, <span class="va">x_mat</span>, <span class="va">beta_new</span>, <span class="va">mu_new</span>, loss_type <span class="op">=</span> <span class="st">"1"</span>, phi <span class="op">=</span> <span class="va">phi</span><span class="op">)</span>
  <span class="co"># update bic according to complexsity upper bound</span>
  <span class="va">current_group_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span><span class="op">)</span>
  <span class="va">current_active_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">beta_new</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">current_active_num</span> <span class="op">+</span> <span class="va">current_group_num</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">11</span><span class="op">)</span><span class="op">{</span>
    <span class="va">bic_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">max_bic</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">best_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">bic_vec</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">best_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span>
  <span class="va">best_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">bic_vec</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
<span class="op">}</span>
<span class="va">mu_new</span> <span class="op">&lt;-</span> <span class="va">mu_further_improve_mat</span><span class="op">[</span><span class="va">best_id</span>, <span class="op">]</span>
<span class="va">beta_new</span> <span class="op">&lt;-</span> <span class="va">beta_further_improve_mat</span><span class="op">[</span><span class="va">best_id</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beta_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x_mat</span><span class="op">)</span></code></pre></div>
<p>After this further improving procedure, the estimated covariate effects are</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">beta_new</span>
<span class="co">#&gt;       sexM        age       Medu       Fedu traveltime  studytime   failures </span>
<span class="co">#&gt;  0.0000000 -0.1164212  0.3768496  0.0000000  0.0000000  0.0000000  0.0000000 </span>
<span class="co">#&gt;     famrel   freetime      goout       Dalc       Walc     health   absences </span>
<span class="co">#&gt;  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000</span></code></pre></div>
<p>and the identified subgroups are</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span>
<span class="co">#&gt; mu_new</span>
<span class="co">#&gt; 11.5671844210441 13.1302268201393 </span>
<span class="co">#&gt;              439              505</span></code></pre></div>
<p>We can visualize the estimated subgroups. First we just need to prepare a data.frame for <code>ggplot</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Mu_to_ID</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu_vec</span>, <span class="va">mu_unique</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># This function converts the original mu vector to a resulting vector, with the same length.</span>
  <span class="co"># But the entries is replaced with the index of this entry in unique(mu_vec), or the provided variable mu_unique</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">mu_unique</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">mu_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_vec</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">mu_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">mu_vec</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">unique_vec</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">unique_vec</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>, unique_vec <span class="op">=</span> <span class="va">mu_unique</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mu_vec</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">rsavs_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">y_vec</span>, 
                        fitted <span class="op">=</span> <span class="va">mu_new</span> <span class="op">+</span> <span class="va">x_mat</span> <span class="op">%*%</span> <span class="va">beta_new</span>, 
                        residual <span class="op">=</span> <span class="va">y_vec</span> <span class="op">-</span> <span class="va">mu_new</span> <span class="op">-</span> <span class="va">x_mat</span> <span class="op">%*%</span> <span class="va">beta_new</span>, 
                        mu_new <span class="op">=</span> <span class="va">mu_new</span>, 
                        mu_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu">Mu_to_ID</span><span class="op">(</span><span class="va">mu_new</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mu_new</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                        course <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"por"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">por_df</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"mat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mat_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">test_idx</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Now we can show the density plot of the <code>G3</code> given the estimated latent subgroups with the dashed line being the median of each group.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsavs_res</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mu_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>subgroup_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">target</span>, fill <span class="op">=</span> <span class="va">mu_id</span>, color <span class="op">=</span> <span class="va">mu_id</span>, group <span class="op">=</span> <span class="va">mu_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">subgroup_median</span>, color <span class="op">=</span> <span class="va">mu_id</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Response"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Subgroup"</span>, fill <span class="op">=</span> <span class="st">"Subgroup"</span><span class="op">)</span></code></pre></div>
<p><img src="Analyize_student_performance_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div id="some-inference-on-the-test-set" class="section level2">
<h2 class="hasAnchor">
<a href="#some-inference-on-the-test-set" class="anchor"></a>Some inference on the test set</h2>
<p>Based on the results from training set, we can propose a model as <span class="math display">\[
y_i = \alpha + \delta d_i + \text{Medu}_i \times \beta_1 + \text{Age}_i \times \beta_2 + \varepsilon_i
\]</span> where <span class="math inline">\(y_i\)</span> refers to the <code>G3</code> of the i-th subject and <span class="math inline">\(d_i = 0\)</span> if the i-th subject belongs to the subgroup 1 and otherwise <span class="math inline">\(d_i = 0\)</span>. <span class="math inline">\(\delta\)</span> is the difference between these 2 subgroups.</p>
<p>We use regular K-medoids method to partition the dataset <span class="math inline">\(D_2\)</span> into two clusters with respect to the adjusted response with the covariate effects removed with the coefficients given by our method based on Dataset <span class="math inline">\(D_1\)</span></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># residual_test is the adjusted response with the covariate effects removed</span>
<span class="va">residual_test</span> <span class="op">&lt;-</span> <span class="va">y_vec_test</span> <span class="op">-</span> <span class="va">x_mat_test</span> <span class="op">%*%</span> <span class="va">beta_new</span>

<span class="co"># cluster residual_test into 2 groups with regular kmeans</span>
<span class="va">tmp_kmeans</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">residual_test</span>, centers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">group_indicator</span> <span class="op">&lt;-</span> <span class="va">tmp_kmeans</span><span class="op">$</span><span class="va">cluster</span> <span class="op">-</span> <span class="fl">1</span>

<span class="co"># form the simplified covariate matrix with only active covariates</span>
<span class="va">x_mat_test_active</span> <span class="op">&lt;-</span> <span class="va">x_mat_test</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">beta_new</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></code></pre></div>
<p>We can make inference about these parameters in the models with the simplified robust regression</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rqfit</span> <span class="op">&lt;-</span> <span class="fu">quantreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/quantreg/man/rq.html">rq</a></span><span class="op">(</span><span class="va">y_vec_test</span> <span class="op">~</span> <span class="va">group_indicator</span> <span class="op">+</span> <span class="va">x_mat_test_active</span><span class="op">)</span>
<span class="co">#&gt; Warning in rq.fit.br(x, y, tau = tau, ...): Solution may be nonunique</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rqfit</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; Warning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be nonunique</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call: quantreg::rq(formula = y_vec_test ~ group_indicator + x_mat_test_active)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; tau: [1] 0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                       coefficients lower bd upper bd</span>
<span class="co">#&gt; (Intercept)           14.52525     11.00448 17.76657</span>
<span class="co">#&gt; group_indicator       -1.32816     -2.13047 -1.11966</span>
<span class="co">#&gt; x_mat_test_activeage  -0.20520     -0.39711 -0.02019</span>
<span class="co">#&gt; x_mat_test_activeMedu  0.35623      0.22410  0.62545</span></code></pre></div>
<p>At 95% confidence level, the results implies that younger students may outperform older ones, and higher <code>G3</code> scores can alos be expected for those children whose mothers have been given higher level education.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Chao Cheng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
